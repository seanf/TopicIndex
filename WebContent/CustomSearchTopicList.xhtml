<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.com/products/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:c="http://java.sun.com/jstl/core"
	xmlns:a4j="http://richfaces.org/a4j"
	template="layout/cleantemplate.xhtml">

	<ui:define name="body">

		<rich:jQuery selector="input[id*='tag-']" timing="onload"
			query="each(function(index, element){if (element.checked){jQuery('input[id*=' + element.id.replace('tag', 'nottag') + ']').removeAttr('disabled');} else {jQuery('input[id*=' + element.id.replace('tag', 'nottag') + ']').attr('disabled', true);}})" />

		<h:form>
			<rich:contextMenu id="oneWayRelatedContentMenu" submitMode="server"
				attached="false">
				<rich:menuItem value="View"
					action="#{groupedTopicTagsList.viewRelatedTopic}"
					rendered="#{s:hasPermission('ViewRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="View New Window" target="_blank"
					action="#{groupedTopicTagsList.viewRelatedTopic}"
					rendered="#{s:hasPermission('ViewRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Remove Relationship"
					action="#{groupedTopicTagsList.removeRelatedById}"
					rendered="#{s:hasPermission('DeleteRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Convert Into 2 Way Relationship"
					action="#{groupedTopicTagsList.makeTwoWayRelatedById}"
					rendered="#{s:hasPermission('DeleteRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
			</rich:contextMenu>
		</h:form>

		<h:form>
			<rich:contextMenu id="incomingWayRelatedContentMenu"
				submitMode="server" attached="false">
				<rich:menuItem value="View"
					action="#{groupedTopicTagsList.viewRelatedTopic}"
					rendered="#{s:hasPermission('ViewRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="View New Window" target="_blank"
					action="#{groupedTopicTagsList.viewRelatedTopic}"
					rendered="#{s:hasPermission('ViewRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Remove Relationship"
					action="#{groupedTopicTagsList.removeIncomingRelatedById}"
					rendered="#{s:hasPermission('DeleteRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Convert Into 2 Way Relationship"
					action="#{groupedTopicTagsList.makeTwoWayRelatedById}"
					rendered="#{s:hasPermission('DeleteRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
			</rich:contextMenu>
		</h:form>



		<h:form>
			<rich:contextMenu id="twoWayRelatedContentMenu" submitMode="server"
				attached="false">
				<rich:menuItem value="View"
					action="#{groupedTopicTagsList.viewRelatedTopic}"
					rendered="#{s:hasPermission('ViewRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="View New Window" target="_blank"
					action="#{groupedTopicTagsList.viewRelatedTopic}"
					rendered="#{s:hasPermission('ViewRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Convert Into 1 Way Relationship (from here)"
					action="#{groupedTopicTagsList.removeOtherRelationship}"
					rendered="#{s:hasPermission('DeleteRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Convert Into 1 Way Relationship (from there)"
					action="#{groupedTopicTagsList.removeThisRelationship}"
					rendered="#{s:hasPermission('DeleteRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Remove Relationship (from both)"
					action="#{groupedTopicTagsList.removeBothRelationships}"
					rendered="#{s:hasPermission('DeleteRelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<a4j:actionparam name="otherTopicId"
						assignTo="#{groupedTopicTagsList.otherTopicId}"
						value="{otherTopicId}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
			</rich:contextMenu>
		</h:form>

		<h:form>
			<rich:contextMenu id="topicContextMenu" submitMode="server"
				attached="false">

				<rich:menuItem value="Add To Temporary List"
					action="#{temporaryTopicList.addToTempList}"
					rendered="#{s:hasPermission('ViewAddToTemporaryListContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{temporaryTopicList.actionTopicID}"
						value="{actionTopicID}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
					<s:conversationPropagation type="join" />
				</rich:menuItem>

				<rich:menuItem value="View" action="#{ajaxHelper.getTopicUrl}"
					rendered="#{s:hasPermission('ViewContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{ajaxHelper.topicId}" value="{actionTopicID}" />
					<a4j:actionparam name="actionBaseUrl"
						assignTo="#{ajaxHelper.baseUrl}" value="/Topic.xhtml" />
					<a4j:actionparam name="revisionNumber"
						assignTo="#{ajaxHelper.otherVars}" value="#{null}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Edit and Tag"
					action="#{ajaxHelper.getTopicUrl}"
					rendered="#{s:hasPermission('EditContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{ajaxHelper.topicId}" value="{actionTopicID}" />
					<a4j:actionparam name="actionBaseUrl"
						assignTo="#{ajaxHelper.baseUrl}" value="/TopicEdit.xhtml" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Manage Relationships"
					action="#{ajaxHelper.getTopicUrl}"
					rendered="#{s:hasPermission('RelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{ajaxHelper.topicId}" value="{actionTopicID}" />
					<a4j:actionparam name="actionOtherVars"
						assignTo="#{ajaxHelper.otherVars}" value="{otherVars}" />
					<a4j:actionparam name="actionBaseUrl"
						assignTo="#{ajaxHelper.baseUrl}"
						value="/CustomRelatedTopicList.xhtml" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>

				<rich:menuItem value="View New Window"
					action="#{ajaxHelper.getTopicUrlAndEndConverstaion}"
					target="_blank"
					rendered="#{s:hasPermission('ViewContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{ajaxHelper.topicId}" value="{actionTopicID}" />
					<a4j:actionparam name="actionBaseUrl"
						assignTo="#{ajaxHelper.baseUrl}" value="/Topic.xhtml" />
					<a4j:actionparam name="revisionNumber"
						assignTo="#{ajaxHelper.otherVars}" value="#{null}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Edit and Tag New Window"
					action="#{ajaxHelper.getTopicUrlAndEndConverstaion}"
					target="_blank"
					rendered="#{s:hasPermission('EditContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{ajaxHelper.topicId}" value="{actionTopicID}" />
					<a4j:actionparam name="actionBaseUrl"
						assignTo="#{ajaxHelper.baseUrl}" value="/TopicEdit.xhtml" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>
				<rich:menuItem value="Manage Relationships New Window"
					action="#{ajaxHelper.getTopicUrlAndEndConverstaion}"
					target="_blank"
					rendered="#{s:hasPermission('RelatedContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{ajaxHelper.topicId}" value="{actionTopicID}" />
					<a4j:actionparam name="actionOtherVars"
						assignTo="#{ajaxHelper.otherVars}" value="{otherVars}" />
					<a4j:actionparam name="actionBaseUrl"
						assignTo="#{ajaxHelper.baseUrl}"
						value="/CustomRelatedTopicList.xhtml" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>

				<rich:menuItem value="Merge with Related Topics"
					action="#{groupedTopicTagsList.mergeTopics}"
					rendered="#{s:hasPermission('MergeContextMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>

				<rich:menuItem value="List Related Topics"
					action="#{groupedTopicTagsList.getRelatedTopicsUrl()}"
					rendered="#{s:hasPermission('ListRelatedTopicsMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>

				<rich:menuItem value="Remove All Relationships"
					action="#{groupedTopicTagsList.removeRelationships()}"
					rendered="#{s:hasPermission('RemoveAllRelationshipsMenuItem', 'Rendered', null)}">
					<a4j:actionparam name="actionTopicID"
						assignTo="#{groupedTopicTagsList.actionTopicID}"
						value="{actionTopicID}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</rich:menuItem>

			</rich:contextMenu>
		</h:form>


		<rich:panel>
			<f:facet name="header">
				<h:outputText
					value="#{groupedTopicTagsList.searchTagHeading}" />
			</f:facet>


			<rich:simpleTogglePanel style="width: 100%; overflow: auto;"
				switchType="client" opened="false">
				<f:facet name="header">Bulk Tags</f:facet>
				<h:form>

					<ui:include src="/WEB-INF/templates/TagSelectAndNotSelect.xhtml">
						<ui:param name="selectedTags"
							value="#{groupedTopicTagsList.selectedTags.projectCategories}" />
						<ui:param name="logicEnabled" value="#{false}" />
					</ui:include>

					<br />
					<br />

					<div>
						<!-- 
							We need to supply the urlVars as f:param. Use a h:commandLink instead 
							of a h:CommandButton, because h:CommandButton has no support for f:param  
						-->
						<h:commandLink id="topicTagsUpdateButton" value="Apply Bulk Tags"
							action="#{groupedTopicTagsList.applyBulkTags()}"
							disabled="#{!s:hasPermission('TopicListRelatedBulkTagButton', 'Enabled', null)}">
							<c:forEach items="#{groupedTopicTagsList.filterVars}"
								var="filtervar">
								<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
							</c:forEach>
						</h:commandLink>
					</div>
				</h:form>
			</rich:simpleTogglePanel>


			<br />

			<rich:simpleTogglePanel label="Temporary Topic List"
				switchType="client"
				opened="#{not empty temporaryTopicList.tempList}"
				rendered="#{not empty temporaryTopicList.tempList}">
				<rich:dataTable value="#{temporaryTopicList.tempList}" var="topic"
					id="tempListTable">
					<rich:column>
						<f:facet name="header">
							<h:outputText value="Topic ID" />
						</f:facet>
						<h:outputText value="#{topic.topicId}" />
					</rich:column>
					<rich:column>
						<f:facet name="header">
							<h:outputText value="Topic Title" />
						</f:facet>
						<h:outputText value="#{topic.topicTitle}" />
					</rich:column>
					<rich:column>
						<f:facet name="header">
							<h:outputText value="Actions" />
						</f:facet>
						<h:form>
							<h:commandLink value="Remove"
								action="#{temporaryTopicList.removeFromTempList(topic.topicId)}" />
						</h:form>
					</rich:column>
				</rich:dataTable>

				<br />

				<div>
					<s:link id="topicTagsViewTempList" value="View Temporary List"
						action="CustomSearchTopicList.xhtml" propagation="none">
						<f:param name="topicIds"
							value="#{temporaryTopicList.tempTopicListURLParam}" />
						<f:param name="firstResult" value="0" />
					</s:link>
					#{' '}
					<s:link id="topicTagsViewTempListNewWindow"
						value="View Temporary List New Window"
						action="CustomSearchTopicList.xhtml" target="_blank"
						propagation="none">
						<f:param name="topicIds"
							value="#{temporaryTopicList.tempTopicListURLParam}" />
						<f:param name="firstResult" value="0" />
					</s:link>
				</div>
			</rich:simpleTogglePanel>

			<br />

			<s:div styleClass="actionButtons" rendered="#{empty from}">
				<s:button view="#{groupedTopicTagsList.createPopulatedTopic()}"
					id="createTop" propagation="none" value="Add Task">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>

				<s:button action="#{groupedTopicTagsList.doBackToSearchLink()}"
					value="Back To Search">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>

				<s:button action="#{groupedTopicTagsList.downloadCSV()}"
					value="Download CSV">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>

				<s:button action="#{groupedTopicTagsList.downloadXML()}"
					value="Download XML">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>
			</s:div>

			<div class="tableControl">

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.previousExists}"
					value="#{messages.left}#{messages.left} First Page"
					id="firstPageTop">
					<f:param name="firstResult" value="0" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.previousExists}"
					value="#{messages.left} Previous Page" id="previousPageTop">
					<f:param name="firstResult"
						value="#{groupedTopicTagsList.previousFirstResult}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.nextExists}"
					value="Next Page #{messages.right}" id="nextPageTop">
					<f:param name="firstResult"
						value="#{groupedTopicTagsList.nextFirstResult}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.nextExists}"
					value="Last Page #{messages.right}#{messages.right}"
					id="lastPageTop">
					<f:param name="firstResult"
						value="#{groupedTopicTagsList.lastFirstResult}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>
			</div>

			<br />
			<br />
			<br />

			<div class="results" id="groupedTopicTagsList">

				<h:outputText value="The topic search returned no results."
					rendered="#{empty groupedTopicTagsList.resultList}" />

				<rich:tabPanel switchType="client">
					<c:forEach items="#{groupedTopicTagsList.groupedTopicLists}"
						var="groupedTopicList">
						<rich:tab label="#{groupedTopicList.detachedTag.tagName} (#{groupedTopicList.topicList.resultCount})"
						name="#{groupedTopicList.detachedTag.tagId}">

							<rich:dataTable var="_topic"
								value="#{groupedTopicList.topicList.resultList}"
								styleClass="listTable"
								columnsWidth="50px, 150px, 75px, 150px, 150px, 50px, 50px, 50px, 200px"
								columnClasses=" , , , , , , , , ">

								<rich:column
									rendered="#{s:hasPermission('TopicListIDColumn', 'Rendered', null)}">
									<f:facet name="header">
										<ui:include src="layout/sort.xhtml">
											<ui:param name="entityList" value="#{topicList}" />
											<ui:param name="propertyLabel" value="ID" />
											<ui:param name="propertyPath" value="topic.topicId" />
										</ui:include>
									</f:facet>

									<h:commandButton
										style="border: 0; background: transparent; color: green;"
										value="#{_topic.topicId}">
										<rich:componentControl event="onclick" for="topicContextMenu"
											operation="show">
											<f:param value="#{_topic.topicId}" name="actionTopicID" />
											<f:param value="#{groupedTopicTagsList.urlVars}&amp;tab=#{groupedTopicList.detachedTag.tagId}" name="otherVars" />
										</rich:componentControl>
									</h:commandButton>
								</rich:column>

								<rich:column
									rendered="#{s:hasPermission('TopicListTitleColumn', 'Rendered', null)}">
									<f:facet name="header">
										<ui:include src="layout/sort.xhtml">
											<ui:param name="entityList" value="#{topicList}" />
											<ui:param name="propertyLabel" value="Topic Title" />
											<ui:param name="propertyPath" value="topic.topicTitle" />
										</ui:include>
									</f:facet>
									<h:outputText value="#{_topic.topicTitle}"
										title="#{_topic.topicText}" />
								</rich:column>

								<rich:column
									rendered="#{s:hasPermission('TopicListAddedByColumn', 'Rendered', null)}">
									<f:facet name="header">
										<ui:include src="layout/sort.xhtml">
											<ui:param name="entityList" value="#{topicList}" />
											<ui:param name="propertyLabel" value="Added By" />
											<ui:param name="propertyPath" value="topic.topicAddedBy" />
										</ui:include>
									</f:facet>
									<h:outputText value="#{_topic.topicAddedBy}" />
								</rich:column>

								<rich:column styleClass="action"
									rendered="#{s:hasPermission('TopicListQuickTagsColumn', 'Rendered', null)}">
									<f:facet name="header">
										<h:outputText value="Quick Tags"
											title="Use these links to toggle the tags applied to a topic" />
									</f:facet>
									<h:form>
										<c:forEach items="#{groupedTopicTagsList.quickTags}" var="tagID">
											<h:commandLink value="#{tagID.name}"
												action="#{groupedTopicTagsList.addTagById(_topic.topicId, tagID.id)}">
												<c:forEach items="#{groupedTopicTagsList.filterVars}"
													var="filtervar">
													<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
												</c:forEach>
												<f:param name="tab" value="#{groupedTopicList.detachedTag.tagId}"/>
											</h:commandLink>
											<br />
										</c:forEach>
									</h:form>
								</rich:column>

								<rich:column
									rendered="#{s:hasPermission('TopicListURLColumn', 'Rendered', null)}">
									<f:facet name="header">
										<h:outputText value="Source Material URL" />
									</f:facet>
									<rich:dataList var="url"
										value="#{_topic.topicToTopicSourceUrls.toArray()}">
										<h:outputLink value="#{url.topicSourceUrl.sourceUrl}"
											title="#{url.topicSourceUrl.sourceUrl} &#13;#{url.topicSourceUrl.description}"
											target="_blank">
											<h:outputText value="Source URL"
												rendered="#{empty url.topicSourceUrl.title}" />
											<h:outputText value="#{url.topicSourceUrl.title}"
												rendered="#{not empty url.topicSourceUrl.title}" />
										</h:outputLink>
									</rich:dataList>
								</rich:column>

								<rich:column
									rendered="#{s:hasPermission('TopicListRelatedTopicsColumn', 'Rendered', null)}">
									<f:facet name="header">
										<h:outputText value="Out"
											title="One way relationships to other topics" />
									</f:facet>
									<a4j:repeat value="#{_topic.oneWayRelatedTopicsArray}"
										var="relatedTopic">
										<h:commandButton
											style="border: 0; background: transparent; color: green;"
											value="#{relatedTopic.topicId}"
											title="#{relatedTopic.topicTitle} &#13;#{relatedTopic.commaSeparatedTagList}">
											<rich:componentControl event="onclick"
												for="oneWayRelatedContentMenu" operation="show">
												<f:param value="#{_topic.topicId}" name="actionTopicID" />
												<f:param value="#{relatedTopic.topicId}" name="otherTopicId" />
											</rich:componentControl>
										</h:commandButton>
									</a4j:repeat>
								</rich:column>

								<rich:column
									rendered="#{s:hasPermission('TopicListRelatedTopicsColumn', 'Rendered', null)}">
									<f:facet name="header">
										<h:outputText value="2 Way" title="Two way related topics" />
									</f:facet>
									<a4j:repeat value="#{_topic.twoWayRelatedTopicsArray}"
										var="relatedTopic">
										<h:commandButton
											style="border: 0; background: transparent; color: blue;"
											value="#{relatedTopic.topicId}"
											title="#{relatedTopic.topicTitle}&#13;#{relatedTopic.commaSeparatedTagList}">
											<rich:componentControl event="onclick"
												for="twoWayRelatedContentMenu" operation="show">
												<f:param value="#{_topic.topicId}" name="actionTopicID" />
												<f:param value="#{relatedTopic.topicId}" name="otherTopicId" />
											</rich:componentControl>
										</h:commandButton>
									</a4j:repeat>
								</rich:column>

								<rich:column
									rendered="#{s:hasPermission('TopicListRelatedTopicsColumn', 'Rendered', null)}">
									<f:facet name="header">
										<h:outputText value="In"
											title="One way relationships from other topics" />
									</f:facet>
									<a4j:repeat value="#{_topic.incomingRelatedTopicsArray}"
										var="relatedTopic">

										<h:commandButton
											style="border: 0; background: transparent; color: red;"
											value="#{relatedTopic.topicId}"
											title="#{relatedTopic.topicTitle}&#13;#{relatedTopic.commaSeparatedTagList}">
											<rich:componentControl event="onclick"
												for="incomingWayRelatedContentMenu" operation="show">
												<f:param value="#{_topic.topicId}" name="actionTopicID" />
												<f:param value="#{relatedTopic.topicId}" name="otherTopicId" />
											</rich:componentControl>
										</h:commandButton>

									</a4j:repeat>
								</rich:column>

								<rich:column
									rendered="#{s:hasPermission('TopicListTagsColumn', 'Rendered', null)}">
									<f:facet name="header">Topic Tags</f:facet>

									<h:outputText escape="false" value="#{_topic.tagsList}" />

								</rich:column>

								<a4j:support reRender="selectiontable"
									action="#{groupedTopicTagsList.takeSelection}"
									event="onselectionchange" />

							</rich:dataTable>
						</rich:tab>
					</c:forEach>
				</rich:tabPanel>
			</div>

			<br />

			<div class="tableControl">

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.previousExists}"
					value="#{messages.left}#{messages.left} First Page" id="firstPage">
					<f:param name="firstResult" value="0" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.previousExists}"
					value="#{messages.left} Previous Page" id="previousPage">
					<f:param name="firstResult"
						value="#{groupedTopicTagsList.previousFirstResult}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.nextExists}"
					value="Next Page #{messages.right}" id="nextPage">
					<f:param name="firstResult"
						value="#{groupedTopicTagsList.nextFirstResult}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>

				<s:link view="/CustomSearchTopicList.xhtml"
					rendered="#{groupedTopicTagsList.nextExists}"
					value="Last Page #{messages.right}#{messages.right}" id="lastPage">
					<f:param name="firstResult"
						value="#{groupedTopicTagsList.lastFirstResult}" />
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:link>
			</div>

			<s:div styleClass="actionButtons" rendered="#{empty from}">
				<s:button view="#{groupedTopicTagsList.createPopulatedTopic()}"
					id="create" propagation="none" value="Add Task">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>
				<s:button action="#{groupedTopicTagsList.doBackToSearchLink()}"
					value="Back To Search">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>

				<s:button action="#{groupedTopicTagsList.downloadCSV()}"
					value="Download CSV">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>

				<s:button action="#{groupedTopicTagsList.downloadXML()}"
					value="Download XML">
					<c:forEach items="#{groupedTopicTagsList.filterVars}"
						var="filtervar">
						<f:param name="#{filtervar.key}" value="#{filtervar.value}" />
					</c:forEach>
				</s:button>
			</s:div>



			<br />
			<br />

		</rich:panel>



	</ui:define>

</ui:composition>
